{"version":3,"sources":["../../../../lib/stream/xlsx/sheet-rels-writer.js"],"names":["utils","require","RelType","HyperlinksProxy","sheetRelsWriter","writer","prototype","push","hyperlink","addHyperlink","SheetRelsWriter","module","exports","options","id","count","_hyperlinks","_workbook","workbook","stream","_stream","_openStream","length","each","fn","forEach","hyperlinksProxy","_hyperlinksProxy","relationship","Target","target","Type","Hyperlink","TargetMode","rId","_writeRelationship","address","addMedia","media","commit","_writeClose","end","_writeOpen","write","xmlEncode"],"mappings":"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","sourcesContent":["'use strict';\r\n\r\nconst utils = require('../../utils/utils');\r\nconst RelType = require('../../xlsx/rel-type');\r\n\r\nconst HyperlinksProxy = function(sheetRelsWriter) {\r\n  this.writer = sheetRelsWriter;\r\n};\r\nHyperlinksProxy.prototype = {\r\n  push(hyperlink) {\r\n    this.writer.addHyperlink(hyperlink);\r\n  },\r\n};\r\n\r\nconst SheetRelsWriter = (module.exports = function(options) {\r\n  // in a workbook, each sheet will have a number\r\n  this.id = options.id;\r\n\r\n  // count of all relationships\r\n  this.count = 0;\r\n\r\n  // keep record of all hyperlinks\r\n  this._hyperlinks = [];\r\n\r\n  this._workbook = options.workbook;\r\n});\r\nSheetRelsWriter.prototype = {\r\n  get stream() {\r\n    if (!this._stream) {\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      this._stream = this._workbook._openStream(`/xl/worksheets/_rels/sheet${this.id}.xml.rels`);\r\n    }\r\n    return this._stream;\r\n  },\r\n\r\n  get length() {\r\n    return this._hyperlinks.length;\r\n  },\r\n\r\n  each(fn) {\r\n    return this._hyperlinks.forEach(fn);\r\n  },\r\n\r\n  get hyperlinksProxy() {\r\n    return this._hyperlinksProxy || (this._hyperlinksProxy = new HyperlinksProxy(this));\r\n  },\r\n  addHyperlink(hyperlink) {\r\n    // Write to stream\r\n    const relationship = {\r\n      Target: hyperlink.target,\r\n      Type: RelType.Hyperlink,\r\n      TargetMode: 'External',\r\n    };\r\n    const rId = this._writeRelationship(relationship);\r\n\r\n    // store sheet stuff for later\r\n    this._hyperlinks.push({\r\n      rId,\r\n      address: hyperlink.address,\r\n    });\r\n  },\r\n\r\n  addMedia(media) {\r\n    return this._writeRelationship(media);\r\n  },\r\n\r\n  commit() {\r\n    if (this.count) {\r\n      // write xml utro\r\n      this._writeClose();\r\n      // and close stream\r\n      this.stream.end();\r\n    }\r\n  },\r\n\r\n  // ================================================================================\r\n  _writeOpen() {\r\n    this.stream.write(\r\n      `<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\r\n       <Relationships xmlns=\"http://schemas.openxmlformats.org/package/2006/relationships\">`\r\n    );\r\n  },\r\n  _writeRelationship(relationship) {\r\n    if (!this.count) {\r\n      this._writeOpen();\r\n    }\r\n\r\n    const rId = `rId${++this.count}`;\r\n\r\n    if (relationship.TargetMode) {\r\n      this.stream.write(\r\n        `<Relationship Id=\"${rId}\"` +\r\n          ` Type=\"${relationship.Type}\"` +\r\n          ` Target=\"${utils.xmlEncode(relationship.Target)}\"` +\r\n          ` TargetMode=\"${relationship.TargetMode}\"` +\r\n          '/>'\r\n      );\r\n    } else {\r\n      this.stream.write(`<Relationship Id=\"${rId}\" Type=\"${relationship.Type}\" Target=\"${relationship.Target}\"/>`);\r\n    }\r\n\r\n    return rId;\r\n  },\r\n  _writeClose() {\r\n    this.stream.write('</Relationships>');\r\n  },\r\n};\r\n"],"file":"sheet-rels-writer.js"}