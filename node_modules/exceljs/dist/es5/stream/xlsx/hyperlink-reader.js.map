{"version":3,"sources":["../../../../lib/stream/xlsx/hyperlink-reader.js"],"names":["events","require","Sax","utils","Enums","RelType","HyperlinkReader","module","exports","workbook","id","_workbook","inherits","EventEmitter","count","hyperlinks","length","each","fn","forEach","read","entry","options","self","emitHyperlinks","autodrain","emit","parser","createStream","on","node","name","rId","attributes","Id","Type","Hyperlink","relationship","type","RelationshipType","Styles","target","Target","targetMode","TargetMode","flowControl","createChild","pipe","sync"],"mappings":"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","sourcesContent":["'use strict';\r\n\r\nconst events = require('events');\r\nconst Sax = require('sax');\r\n\r\nconst utils = require('../../utils/utils');\r\nconst Enums = require('../../doc/enums');\r\nconst RelType = require('../../xlsx/rel-type');\r\n\r\nconst HyperlinkReader = (module.exports = function(workbook, id) {\r\n  // in a workbook, each sheet will have a number\r\n  this.id = id;\r\n\r\n  this._workbook = workbook;\r\n});\r\n\r\nutils.inherits(HyperlinkReader, events.EventEmitter, {\r\n  get count() {\r\n    return (this.hyperlinks && this.hyperlinks.length) || 0;\r\n  },\r\n\r\n  each(fn) {\r\n    return this.hyperlinks.forEach(fn);\r\n  },\r\n\r\n  read(entry, options) {\r\n    const self = this;\r\n    let emitHyperlinks = false;\r\n    let hyperlinks = null;\r\n    switch (options.hyperlinks) {\r\n      case 'emit':\r\n        emitHyperlinks = true;\r\n        break;\r\n      case 'cache':\r\n        this.hyperlinks = hyperlinks = {};\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n    if (!emitHyperlinks && !hyperlinks) {\r\n      entry.autodrain();\r\n      self.emit('finished');\r\n      return;\r\n    }\r\n\r\n    const parser = Sax.createStream(true, {});\r\n    parser.on('opentag', node => {\r\n      if (node.name === 'Relationship') {\r\n        const rId = node.attributes.Id;\r\n        switch (node.attributes.Type) {\r\n          case RelType.Hyperlink:\r\n            const relationship = {\r\n              type: Enums.RelationshipType.Styles,\r\n              rId,\r\n              target: node.attributes.Target,\r\n              targetMode: node.attributes.TargetMode,\r\n            };\r\n            if (emitHyperlinks) {\r\n              self.emit('hyperlink', relationship);\r\n            } else {\r\n              hyperlinks[relationship.rId] = relationship;\r\n            }\r\n            break;\r\n          default:\r\n            break;\r\n        }\r\n      }\r\n    });\r\n    parser.on('end', () => {\r\n      self.emit('finished');\r\n    });\r\n\r\n    // create a down-stream flow-control to regulate the stream\r\n    const flowControl = this._workbook.flowControl.createChild();\r\n    flowControl.pipe(\r\n      parser,\r\n      { sync: true }\r\n    );\r\n    entry.pipe(flowControl);\r\n  },\r\n});\r\n"],"file":"hyperlink-reader.js"}